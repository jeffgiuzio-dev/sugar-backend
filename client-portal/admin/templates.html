<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Templates - Kenna Giuzio Cake</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #faf8f5;
            --bg-secondary: #fff;
            --bg-tertiary: #fafafa;
            --bg-hover: #f5f3f0;
            --text-primary: #1a1a1a;
            --text-secondary: #666;
            --text-muted: #999;
            --border-color: #eee;
            --border-light: #f0f0f0;
            --accent-gold: #b5956a;
            --accent-gold-hover: #a08050;
            --modal-bg: #fff;
            --input-bg: #fff;
            --shadow: rgba(0,0,0,0.1);
            --overlay: rgba(0,0,0,0.5);
        }

        body.dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #252525;
            --bg-tertiary: #2d2d2d;
            --bg-hover: #333;
            --text-primary: #e0e0e0;
            --text-secondary: #aaa;
            --text-muted: #777;
            --border-color: #3a3a3a;
            --border-light: #333;
            --accent-gold: #c9a66a;
            --accent-gold-hover: #d4b87a;
            --modal-bg: #252525;
            --input-bg: #2d2d2d;
            --shadow: rgba(0,0,0,0.3);
            --overlay: rgba(0,0,0,0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            font-weight: 300;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 30px 0;
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        .logo {
            text-align: center;
            padding: 30px 30px 30px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo img {
            width: 160px;
            height: auto;
        }

        body.dark-mode .logo img {
            filter: invert(0.85);
        }

        .nav-menu {
            padding: 30px 0;
            flex: 1;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 30px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-left-color: var(--accent-gold);
        }

        .nav-item svg {
            width: 18px;
            height: 18px;
            opacity: 0.7;
        }

        .nav-divider {
            height: 1px;
            background: var(--border-color);
            margin: 16px 30px;
        }

        /* Main Content */
        .main-wrapper {
            margin-left: 260px;
            min-height: 100vh;
        }

        .header {
            background: url('../images/header-flowers.jpg') center center / cover no-repeat;
            padding: 40px;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
        }

        .header > * {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 300;
            font-size: 2rem;
            color: #fff;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .main {
            padding: 40px;
        }

        /* Section */
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .section-header h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            font-weight: 400;
            color: var(--text-primary);
        }

        .section-header .icon {
            width: 24px;
            height: 24px;
            color: var(--accent-gold);
        }

        /* Template List */
        .template-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 600px;
        }

        .template-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .template-item:hover {
            border-color: var(--accent-gold);
        }

        .template-info h3 {
            font-size: 0.95rem;
            font-weight: 400;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .template-info p {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .template-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        .btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .btn-primary {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
            color: #fff;
        }

        .btn-primary:hover {
            background: var(--accent-gold-hover);
            border-color: var(--accent-gold-hover);
            color: #fff;
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        /* Prevent body scroll when modal open */
        body.modal-open {
            overflow: hidden;
        }

        /* Preview/Edit Modal */
        .modal {
            background: var(--modal-bg);
            width: 650px;
            height: 70vh;
            min-width: 400px;
            min-height: 300px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 20px var(--shadow);
            display: flex;
            flex-direction: column;
            position: absolute;
            resize: both;
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            cursor: move;
            user-select: none;
        }

        .modal-header h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            font-weight: 400;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
            overscroll-behavior: contain;
            display: flex;
            flex-direction: column;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.flex-grow {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-bottom: 0;
        }

        .form-group.flex-grow textarea {
            flex: 1;
            min-height: 200px;
        }

        .form-group label {
            font-size: 0.7rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-muted);
            display: block;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text-primary);
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-gold);
        }

        .form-group textarea {
            resize: none;
            line-height: 1.6;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-primary);
            flex-shrink: 0;
        }

        .modal-footer-right {
            display: flex;
            gap: 12px;
        }

        /* Confirmation Dialog - Elegant Style */
        .confirm-dialog {
            background: var(--modal-bg);
            width: 100%;
            max-width: 400px;
            margin: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 30px var(--shadow);
            text-align: center;
        }

        .confirm-dialog .confirm-icon {
            padding: 30px 24px 0;
            color: var(--accent-gold);
        }

        .confirm-dialog .confirm-icon svg {
            width: 48px;
            height: 48px;
        }

        .confirm-dialog .confirm-content {
            padding: 20px 30px 30px;
        }

        .confirm-dialog h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            font-weight: 400;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .confirm-dialog p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .confirm-dialog .confirm-actions {
            padding: 0 24px 24px;
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .confirm-dialog .btn {
            min-width: 100px;
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo">
            <img src="../images/logo.png" alt="Kenna Giuzio Cake">
        </div>

        <nav class="nav-menu">
            <a href="/admin/in-studio.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
                In Studio
            </a>
            <a href="/admin/calendar.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                Calendar
            </a>
            <a href="/admin/contacts.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                Contacts
            </a>
            <a href="/admin/communications.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
                Communications
            </a>
            <a href="/admin/templates.html" class="nav-item active">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                    <polyline points="10 9 9 9 8 9"/>
                </svg>
                Templates
            </a>

            <div class="nav-divider"></div>

            <a href="/admin/finances.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <line x1="18" y1="20" x2="18" y2="10"/>
                    <line x1="12" y1="20" x2="12" y2="4"/>
                    <line x1="6" y1="20" x2="6" y2="14"/>
                </svg>
                Finances
            </a>
            <a href="/admin/media.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21 15 16 10 5 21"/>
                </svg>
                Media
            </a>

            <div class="nav-divider"></div>

            <a href="/admin/settings.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
                Settings
            </a>
            <a href="/admin/archive.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <polyline points="21 8 21 21 3 21 3 8"/>
                    <rect x="1" y="3" width="22" height="5"/>
                    <line x1="10" y1="12" x2="14" y2="12"/>
                </svg>
                Archive
            </a>
        </nav>

        <!-- Dark Mode Toggle -->
        <div style="padding: 14px 30px; margin-top: auto;">
            <button onclick="toggleDarkMode()" id="darkModeBtn" style="display: flex; align-items: center; gap: 10px; width: 100%; padding: 10px 14px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; font-family: 'Montserrat', sans-serif; font-size: 0.8rem; color: var(--text-secondary); transition: all 0.2s;">
                <span id="darkModeIcon">üåô</span>
                <span id="darkModeText">Night Mode</span>
            </button>
        </div>
    </aside>

    <div class="main-wrapper">
        <header class="header">
            <h1>Templates</h1>
        </header>

        <main class="main">
            <div style="display: flex; gap: 40px; align-items: flex-start;">
                <!-- Email Templates Section -->
                <div style="flex: 1;">
                    <div class="section-header">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <polyline points="22,6 12,13 2,6"/>
                        </svg>
                        <h2>Email Templates</h2>
                    </div>

                    <div class="template-list" id="templateList">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Tasting Proposal Template Section -->
                <div style="flex: 1;">
                    <div class="section-header">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        <h2>Tasting Proposal</h2>
                    </div>

                    <div class="template-list">
                        <div class="template-item">
                            <div class="template-info">
                                <h3>Default Tasting Proposal <span id="tastingCustomBadge" style="color:#b5956a; font-size:0.7rem;"></span></h3>
                                <p>Description, arrival instructions, location, and fee used when scheduling new tastings</p>
                            </div>
                            <div class="template-actions">
                                <button class="btn" onclick="openTastingModal()">Preview</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Preview/Edit Modal -->
    <div class="modal-overlay" id="editModal" onclick="if(event.target===this) closeEditModal()">
        <div class="modal">
            <div class="modal-header">
                <h2 id="editModalTitle">Template Name</h2>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Subject Line</label>
                    <input type="text" id="editSubject">
                </div>
                <div class="form-group flex-grow">
                    <label>Email Body</label>
                    <textarea id="editBody"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="resetTemplate()">Reset to Default</button>
                <div class="modal-footer-right">
                    <button class="btn" onclick="closeEditModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmSave()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div class="modal-overlay" id="confirmModal" onclick="if(event.target===this) closeConfirmModal()">
        <div class="confirm-dialog">
            <div class="confirm-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="12" y1="18" x2="12" y2="12"/>
                    <line x1="12" y1="9" x2="12" y2="9"/>
                </svg>
            </div>
            <div class="confirm-content">
                <h3>Update Template?</h3>
                <p>This will change the default template language. You can always reset it later.</p>
            </div>
            <div class="confirm-actions">
                <button class="btn" onclick="closeConfirmModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveTemplate()">Yes, Update</button>
            </div>
        </div>
    </div>

    <!-- Tasting Proposal Edit Modal -->
    <div class="modal-overlay" id="tastingModal">
        <div class="modal" style="width: 900px; max-width: 95vw; height: 80vh;">
            <div class="modal-header">
                <h2>Tasting Proposal Template</h2>
                <button class="modal-close" onclick="closeTastingModal()">&times;</button>
            </div>
            <div class="modal-body" style="flex-direction: row; gap: 24px; padding: 24px;">
                <!-- Edit Fields -->
                <div style="flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 16px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Invoice Banner Image</label>
                        <div id="bannerPicker" style="display: flex; gap: 8px; flex-wrap: wrap;"></div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Tasting Description</label>
                        <textarea id="tastingTplDescription" oninput="updateTastingPreview()" style="min-height: 100px;"></textarea>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Arrival Instructions</label>
                        <textarea id="tastingTplArrival" oninput="updateTastingPreview()" style="min-height: 80px;"></textarea>
                    </div>
                    <div style="display: flex; gap: 16px;">
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label>Default Location</label>
                            <input type="text" id="tastingTplLocation" oninput="updateTastingPreview()">
                        </div>
                        <div class="form-group" style="flex: 0 0 120px; margin-bottom: 0;">
                            <label>Default Fee ($)</label>
                            <input type="text" id="tastingTplFee" oninput="updateTastingPreview()">
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Default Number of Guests</label>
                        <select id="tastingTplGuests" oninput="updateTastingPreview()" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-family: 'Montserrat', sans-serif; font-size: 0.9rem;">
                            <option value="2">2 guests</option>
                            <option value="3">3 guests</option>
                            <option value="4">4 guests</option>
                            <option value="5">5 guests</option>
                            <option value="6">6 guests</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Default Internal Notes</label>
                        <textarea id="tastingTplNotes" style="min-height: 60px;" placeholder="Internal only - not shown on invoice"></textarea>
                    </div>
                </div>

                <!-- Live Preview -->
                <div style="flex: 1; overflow-y: auto; background: #fff; border: 1px solid var(--border-color); font-family: 'Cormorant Garamond', serif; color: #1a1a1a;">
                    <!-- Banner -->
                    <div id="tastingPreviewBanner" style="height: 90px; background: url('/images/header-flowers.jpg') 30% center / cover no-repeat; display: flex; align-items: center; padding-left: 16px; position: relative;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.15);"></div>
                        <img src="/images/logo.png" alt="Kenna Giuzio Cake" style="width: 80px; position: relative; z-index: 1;">
                    </div>
                    <div style="text-align: center; font-family: 'Montserrat', sans-serif; font-size: 0.7rem; color: #666; padding: 8px 0; border-bottom: 1px solid #eee;">
                        (206) 472-5401 | kenna@kennagiuziocake.com<br>Queen Anne, Seattle
                    </div>
                    <div style="padding: 20px 30px;">
                    <div style="text-align: right; margin-bottom: 20px;">
                        <div style="font-size: 1.4rem; font-weight: 400;">Tasting Invoice</div>
                        <div style="font-size: 0.75rem; font-family: 'Montserrat', sans-serif; color: #999; margin-top: 4px;">PREVIEW</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid #eee;">
                        <div>
                            <div style="font-size: 0.65rem; font-family: 'Montserrat', sans-serif; text-transform: uppercase; letter-spacing: 1px; color: #999;">Bill To</div>
                            <div style="font-size: 1rem;">Sample Client</div>
                            <div style="font-size: 0.85rem; color: #666;">client@email.com</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 0.65rem; font-family: 'Montserrat', sans-serif; text-transform: uppercase; letter-spacing: 1px; color: #999;">Event</div>
                            <div style="font-size: 1rem;">Wedding - Summer 2026</div>
                        </div>
                    </div>

                    <h3 style="font-size: 1.1rem; font-weight: 400; margin-bottom: 8px;">Tasting Party</h3>
                    <p id="tastingPreviewDesc" style="font-size: 0.85rem; font-family: 'Montserrat', sans-serif; font-weight: 300; color: #444; line-height: 1.6; white-space: pre-line;"></p>
                    <p style="font-size: 0.7rem; font-style: italic; color: #888; margin-top: 10px; margin-bottom: 14px; font-family: 'Montserrat', sans-serif;">Custom cake commissions begin at $2,500. This tasting is designed to explore fit, flavor, and creative direction before moving forward.</p>

                    <div style="background: #faf8f5; border: 1px solid #eee; padding: 16px; margin-bottom: 16px;">
                        <div style="font-size: 0.6rem; font-family: 'Montserrat', sans-serif; text-transform: uppercase; letter-spacing: 1.5px; color: #999; margin-bottom: 8px;">Tasting Details</div>
                        <div style="font-size: 0.9rem;" id="tastingPreviewDate">February 20, 2026</div>
                        <div style="font-size: 0.9rem;">12:00 PM</div>
                        <div style="font-size: 0.9rem;" id="tastingPreviewLocation"></div>
                        <div style="font-size: 0.6rem; font-family: 'Montserrat', sans-serif; text-transform: uppercase; letter-spacing: 1.5px; color: #999; margin-top: 12px; margin-bottom: 6px;">Arrival</div>
                        <div id="tastingPreviewArrival" style="font-size: 0.85rem; color: #666; line-height: 1.5; font-family: 'Montserrat', sans-serif; font-weight: 300; white-space: pre-line;"></div>
                    </div>

                    <div style="text-align: right; font-size: 1.1rem; margin-bottom: 16px;">$<span id="tastingPreviewFee">250</span></div>

                    <div style="border-top: 1px solid #eee; padding-top: 12px;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 6px;">
                            <span>Subtotal</span>
                            <span>$<span id="tastingPreviewSubtotal">250.00</span></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #999; margin-bottom: 6px;">
                            <span>Processing Fee (3.4%)</span>
                            <span>$<span id="tastingPreviewProcessing">8.50</span></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 1.1rem; font-weight: 400; border-top: 1px solid #1a1a1a; padding-top: 10px;">
                            <span>Total</span>
                            <span>$<span id="tastingPreviewTotal">258.50</span></span>
                        </div>
                    </div>
                    </div><!-- close padding div -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="resetTastingTemplate()">Reset to Default</button>
                <div class="modal-footer-right">
                    <button class="btn" onclick="closeTastingModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveTastingTemplate()">Save as Default</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark Mode - check saved preference on load
        (function() {
            const darkMode = localStorage.getItem('kgc_dark_mode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
            }
            document.addEventListener('DOMContentLoaded', updateDarkModeButton);
        })();

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('kgc_dark_mode', isDark);
            updateDarkModeButton();
        }

        function updateDarkModeButton() {
            const isDark = document.body.classList.contains('dark-mode');
            const icon = document.getElementById('darkModeIcon');
            const text = document.getElementById('darkModeText');
            if (icon && text) {
                icon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
                text.textContent = isDark ? 'Day Mode' : 'Night Mode';
            }
        }

        // Default Email Templates
        const defaultTemplates = {
            'inquiry-response': {
                name: 'Inquiry Response',
                description: 'Thank them for reaching out, confirm date availability',
                subject: 'Thank You for Your Inquiry - {eventType}',
                body: `Hi {firstName},

Thank you so much for reaching out about your {eventType}! I'm excited to hear about your vision for {eventDate}.

Great news - your date is currently available!

Here's how my process works:

1. TASTING CONSULTATION
We'll schedule a tasting where you can sample flavors and we'll discuss your design vision in detail. Tastings are complimentary and typically last about an hour.

2. CUSTOM PROPOSAL
After our tasting, I'll create a detailed proposal with pricing based on your specific design, guest count, and any special requirements.

3. BOOKING
A 50% deposit locks in your date. The remaining balance is due two weeks before your event.

I'd love to learn more about your event! Are there other team members (planner, florist, venue coordinator) I should connect with?

Looking forward to creating something beautiful for your celebration!

Warmly,
Kenna`
            },
            'tasting-options': {
                name: 'Tasting Options',
                description: 'Offer available tasting dates and times',
                subject: 'Tasting Options for Your {eventType}',
                body: `Hi {firstName},

I'd love to schedule your tasting consultation! Here is a date and time that works for me:

[Click to select date/time]

Tastings typically last about an hour. We'll sample flavors, discuss your design vision, and I'll answer any questions you have.

Please let me know if this works for you, or if you'd prefer a different time, share a few times that fit your schedule and I'll do my best to accommodate.

Looking forward to meeting you!

Warmly,
Kenna`
            },
            'tasting-confirmation': {
                name: 'Tasting Confirmation',
                description: 'Combined tasting confirmation + payment receipt (sent automatically after payment)',
                subject: 'Tasting Confirmed - {tastingDate}',
                body: `Dear {firstName},

Thank you for your payment of {amount}. Your tasting is confirmed!

YOUR TASTING:
Date: {tastingDate} at {tastingTime}
Location: Queen Anne, Seattle
Duration: Approximately 1 hour

WHAT TO EXPECT:
- Sample a variety of cake flavors and fillings
- Discuss your design vision and inspiration
- Review timeline and logistics

Feel free to bring any inspiration photos, color swatches, or your event team members.

If you have any questions before your tasting, don't hesitate to reach out.

See you soon,
Kenna

Kenna Giuzio Cake
(206) 472-5401
kenna@kennagiuziocake.com`
            },
            'proposal-delivery': {
                name: 'Proposal Ready',
                description: 'Let them know their custom proposal is ready',
                subject: 'Your Custom Proposal is Ready!',
                body: `Hi {firstName},

It was wonderful meeting you at your tasting! I've put together a custom proposal for your {eventType}.

You can view your proposal here:
[PROPOSAL LINK]

The proposal includes:
- Design details based on our conversation
- Itemized pricing
- Timeline and delivery information

To secure your date, a 50% deposit is required. Once received, your {eventDate} date will be officially booked!

Please let me know if you have any questions or would like to make any adjustments.

Excited to create this for you!

Warmly,
Kenna`
            },
            'booking-confirmation': {
                name: 'Booking Confirmation',
                description: 'Thank them for booking, confirm next steps',
                subject: 'You\'re Booked! - {eventDate}',
                body: `Hi {firstName},

Wonderful news - your date is officially booked! Thank you so much for trusting me with your {eventType}.

WHAT'S NEXT:
- Your remaining balance will be due two weeks before your event ({balanceDueDate})
- I'll reach out closer to your date to confirm final details
- If anything changes with your event, just let me know

I'm so excited to create something beautiful for your celebration!

Warmly,
Kenna`
            },
            'one-month-reminder': {
                name: 'One Month Reminder',
                description: 'Friendly reminder about upcoming balance',
                subject: 'One Month Until Your {eventType}!',
                body: `Hi {firstName},

Can you believe your {eventType} is just one month away?! I'm getting excited to deliver your cake!

Just a friendly reminder that your remaining balance of {balanceAmount} will be due on {balanceDueDate} (two weeks before your event).

If you have any last-minute questions or changes, now is the perfect time to let me know.

Counting down with you!

Warmly,
Kenna`
            },
            'two-week-reminder': {
                name: 'Final Balance Due',
                description: 'Balance due reminder two weeks before event',
                subject: 'Final Balance Due - {eventType}',
                body: `Hi {firstName},

Your {eventType} is just two weeks away!

This is a friendly reminder that your final balance of {balanceAmount} is now due.

DELIVERY DETAILS:
- Date: {eventDate}
- Time: [DELIVERY TIME]
- Location: {venue}

Please let me know if any details have changed. I'll reach out a few days before to confirm everything.

So excited for your big day!

Warmly,
Kenna`
            },
            'tasting-invoice-email': {
                name: 'Tasting Invoice Email',
                description: 'Branded email sent with tasting invoice link',
                subject: 'Your Tasting Invitation - {tastingDate}',
                body: `Dear {firstName},

Thank you so much for reaching out! I'm thrilled at the opportunity to create something beautiful for your {eventType}.

I'd love to invite you to a tasting party at my studio where we can sample cakes, explore designs, and discuss your vision together.

Your tasting is scheduled for:
{tastingDate} at {tastingTime}

Click below to view your invoice to schedule your tasting.

I can't wait to meet you and hear all about what you're dreaming of!

Warmly,
Kenna

Kenna Giuzio Cake
(206) 472-5401
kenna@kennagiuziocake.com`
            }
        };

        let currentTemplateId = null;
        let customTemplates = {};

        // Load custom templates from localStorage
        function loadCustomTemplates() {
            customTemplates = JSON.parse(localStorage.getItem('kgc_email_templates') || '{}');
        }

        // Get template (custom or default)
        function getTemplate(id) {
            if (customTemplates[id]) {
                return { ...defaultTemplates[id], ...customTemplates[id] };
            }
            return defaultTemplates[id];
        }

        function getVersionLabel(custom) {
            if (!custom) return '<span style="color:var(--text-muted); font-size:0.7rem;">Original Default</span>';
            const v = custom.version || 1;
            return `<span style="color:#b5956a; font-size:0.7rem;">Version ${v}</span>`;
        }

        // Render template list
        function renderTemplates() {
            const container = document.getElementById('templateList');
            container.innerHTML = Object.entries(defaultTemplates).map(([id, t]) => {
                const custom = customTemplates[id];
                return `
                    <div class="template-item">
                        <div class="template-info">
                            <h3>${t.name} ${getVersionLabel(custom)}</h3>
                            <p>${t.description}</p>
                        </div>
                        <div class="template-actions">
                            <button class="btn" onclick="openEditModal('${id}')">Preview</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Open edit modal
        function openEditModal(templateId) {
            currentTemplateId = templateId;
            const template = getTemplate(templateId);

            document.getElementById('editModalTitle').textContent = template.name;
            document.getElementById('editSubject').value = template.subject;
            document.getElementById('editBody').value = template.body;

            const overlay = document.getElementById('editModal');
            const modal = overlay.querySelector('.modal');

            // Center the modal
            modal.style.left = '50%';
            modal.style.top = '50%';
            modal.style.transform = 'translate(-50%, -50%)';

            overlay.style.display = 'flex';
            document.body.classList.add('modal-open');
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            document.body.classList.remove('modal-open');
            currentTemplateId = null;
        }

        // Show confirmation dialog
        function confirmSave() {
            document.getElementById('confirmModal').style.display = 'flex';
            document.body.classList.add('modal-open');
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
            // Keep body locked if edit modal is still open
            if (document.getElementById('editModal').style.display !== 'flex') {
                document.body.classList.remove('modal-open');
            }
        }

        // Save template
        function saveTemplate() {
            if (!currentTemplateId) return;

            const subject = document.getElementById('editSubject').value;
            const body = document.getElementById('editBody').value;

            const currentVersion = (customTemplates[currentTemplateId]?.version || 0) + 1;
            customTemplates[currentTemplateId] = { subject, body, version: currentVersion };
            localStorage.setItem('kgc_email_templates', JSON.stringify(customTemplates));

            document.getElementById('confirmModal').style.display = 'none';
            document.getElementById('editModal').style.display = 'none';
            document.body.classList.remove('modal-open');
            currentTemplateId = null;
            renderTemplates();
        }

        // Reset template to default
        function resetTemplate() {
            if (!currentTemplateId) return;

            delete customTemplates[currentTemplateId];
            localStorage.setItem('kgc_email_templates', JSON.stringify(customTemplates));

            // Refresh modal with default
            const template = defaultTemplates[currentTemplateId];
            document.getElementById('editSubject').value = template.subject;
            document.getElementById('editBody').value = template.body;

            renderTemplates();
        }

        // Initialize
        loadCustomTemplates();
        renderTemplates();

        // ===== Draggable Modal Functionality =====
        function makeDraggable(modal) {
            const header = modal.querySelector('.modal-header');
            let isDragging = false;
            let startX, startY, initialX, initialY;

            header.addEventListener('mousedown', function(e) {
                if (e.target.classList.contains('modal-close')) return;
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;

                const rect = modal.getBoundingClientRect();
                initialX = rect.left;
                initialY = rect.top;

                // Remove centering transform when starting drag
                modal.style.transform = 'none';
                modal.style.left = initialX + 'px';
                modal.style.top = initialY + 'px';

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });

            function onMouseMove(e) {
                if (!isDragging) return;
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;

                let newLeft = initialX + dx;
                let newTop = initialY + dy;

                // Keep modal within viewport bounds
                const rect = modal.getBoundingClientRect();
                const minTop = 10;
                const minLeft = -rect.width + 100; // Keep at least 100px visible
                const maxLeft = window.innerWidth - 100;
                const maxTop = window.innerHeight - 50;

                newTop = Math.max(minTop, Math.min(maxTop, newTop));
                newLeft = Math.max(minLeft, Math.min(maxLeft, newLeft));

                modal.style.left = newLeft + 'px';
                modal.style.top = newTop + 'px';
            }

            function onMouseUp() {
                isDragging = false;
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            }
        }

        // Apply draggable to edit modal
        makeDraggable(document.querySelector('#editModal .modal'));

        // ===== Tasting Proposal Template =====
        const tastingDefaults = {
            description: 'A bespoke tasting party and design consultation for you and your guests at my studio during which we will sample cakes, review designs and discuss your vision.',
            arrival: 'The studio entrance is on the W 3rd Ave side of the house.\nI\'ll meet you there! At the tall white gate in front of my blue studio door.',
            location: 'Queen Anne Studio, Seattle',
            fee: '250',
            guests: '2',
            notes: '',
            bannerImage: '/images/header-flowers.jpg'
        };

        // Available banner images
        const bannerImages = [
            { src: '/images/header-flowers.jpg', label: 'Flowers' },
            { src: '/images/hero.jpg', label: 'Hero' },
            { src: '/images/cake-01.jpg', label: 'Cake 1' },
            { src: '/images/cake-02.jpg', label: 'Cake 2' },
            { src: '/images/cake-03.jpg', label: 'Cake 3' },
            { src: '/images/cake-04.jpg', label: 'Cake 4' },
            { src: '/images/cake-05.jpg', label: 'Cake 5' },
            { src: '/images/cake-06.jpg', label: 'Cake 6' },
            { src: '/images/cake-07.jpg', label: 'Cake 7' },
            { src: '/images/cake-08.jpg', label: 'Cake 8' },
            { src: '/images/cake-09.jpg', label: 'Cake 9' },
            { src: '/images/cake-10.jpg', label: 'Cake 10' },
        ];

        let selectedBanner = tastingDefaults.bannerImage;

        function getTastingTemplate() {
            const saved = JSON.parse(localStorage.getItem('kgc_tasting_defaults') || '{}');
            return {
                description: saved.description || tastingDefaults.description,
                arrival: saved.arrival || tastingDefaults.arrival,
                location: saved.location || tastingDefaults.location,
                fee: saved.fee || tastingDefaults.fee,
                guests: saved.guests || tastingDefaults.guests,
                notes: saved.notes || tastingDefaults.notes,
                bannerImage: saved.bannerImage || tastingDefaults.bannerImage
            };
        }

        function renderBannerPicker(currentBanner) {
            const container = document.getElementById('bannerPicker');
            container.innerHTML = bannerImages.map(img => {
                const isSelected = img.src === currentBanner;
                return `<div onclick="selectBanner('${img.src}')" style="width: 70px; height: 45px; background: url('${img.src}') center / cover no-repeat; cursor: pointer; border: 2px solid ${isSelected ? 'var(--accent-gold)' : 'transparent'}; opacity: ${isSelected ? '1' : '0.6'}; transition: all 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='${isSelected ? '1' : '0.6'}'"></div>`;
            }).join('');
        }

        function selectBanner(src) {
            selectedBanner = src;
            renderBannerPicker(src);
            document.getElementById('tastingPreviewBanner').style.backgroundImage = `url('${src}')`;
        }

        function openTastingModal() {
            const tpl = getTastingTemplate();
            document.getElementById('tastingTplDescription').value = tpl.description;
            document.getElementById('tastingTplArrival').value = tpl.arrival;
            document.getElementById('tastingTplLocation').value = tpl.location;
            document.getElementById('tastingTplFee').value = tpl.fee;
            document.getElementById('tastingTplGuests').value = tpl.guests;
            document.getElementById('tastingTplNotes').value = tpl.notes;
            selectedBanner = tpl.bannerImage;
            renderBannerPicker(selectedBanner);
            document.getElementById('tastingPreviewBanner').style.backgroundImage = `url('${selectedBanner}')`;
            updateTastingPreview();

            const overlay = document.getElementById('tastingModal');
            const modal = overlay.querySelector('.modal');
            modal.style.left = '50%';
            modal.style.top = '50%';
            modal.style.transform = 'translate(-50%, -50%)';
            overlay.style.display = 'flex';
            document.body.classList.add('modal-open');
        }

        function closeTastingModal() {
            document.getElementById('tastingModal').style.display = 'none';
            document.body.classList.remove('modal-open');
        }

        function updateTastingPreview() {
            const desc = document.getElementById('tastingTplDescription').value;
            const arrival = document.getElementById('tastingTplArrival').value;
            const location = document.getElementById('tastingTplLocation').value;
            const fee = parseFloat(document.getElementById('tastingTplFee').value) || 0;

            document.getElementById('tastingPreviewDesc').textContent = desc;
            document.getElementById('tastingPreviewArrival').textContent = arrival;
            document.getElementById('tastingPreviewLocation').textContent = location;
            document.getElementById('tastingPreviewFee').textContent = fee.toFixed(0);

            const subtotal = fee;
            const processing = Math.round(fee * 0.034 * 100) / 100;
            const total = subtotal + processing;
            document.getElementById('tastingPreviewSubtotal').textContent = subtotal.toFixed(2);
            document.getElementById('tastingPreviewProcessing').textContent = processing.toFixed(2);
            document.getElementById('tastingPreviewTotal').textContent = total.toFixed(2);
        }

        function saveTastingTemplate() {
            const existing = JSON.parse(localStorage.getItem('kgc_tasting_defaults') || '{}');
            const currentVersion = (existing.version || 0) + 1;
            const tpl = {
                description: document.getElementById('tastingTplDescription').value,
                arrival: document.getElementById('tastingTplArrival').value,
                location: document.getElementById('tastingTplLocation').value,
                fee: document.getElementById('tastingTplFee').value,
                guests: document.getElementById('tastingTplGuests').value,
                notes: document.getElementById('tastingTplNotes').value,
                bannerImage: selectedBanner,
                version: currentVersion
            };
            localStorage.setItem('kgc_tasting_defaults', JSON.stringify(tpl));
            closeTastingModal();
            updateTastingCustomBadge();
        }

        function resetTastingTemplate() {
            if (!confirm('Reset tasting proposal to factory defaults?')) return;
            localStorage.removeItem('kgc_tasting_defaults');
            const tpl = tastingDefaults;
            document.getElementById('tastingTplDescription').value = tpl.description;
            document.getElementById('tastingTplArrival').value = tpl.arrival;
            document.getElementById('tastingTplLocation').value = tpl.location;
            document.getElementById('tastingTplFee').value = tpl.fee;
            document.getElementById('tastingTplGuests').value = tpl.guests;
            document.getElementById('tastingTplNotes').value = tpl.notes;
            selectedBanner = tpl.bannerImage;
            renderBannerPicker(selectedBanner);
            document.getElementById('tastingPreviewBanner').style.backgroundImage = `url('${selectedBanner}')`;
            updateTastingPreview();
            updateTastingCustomBadge();
        }

        function updateTastingCustomBadge() {
            const saved = JSON.parse(localStorage.getItem('kgc_tasting_defaults') || 'null');
            const badge = document.getElementById('tastingCustomBadge');
            if (!saved) {
                badge.innerHTML = '<span style="color:var(--text-muted);">Original Default</span>';
            } else {
                const v = saved.version || 1;
                badge.textContent = 'Version ' + v;
            }
        }

        updateTastingCustomBadge();
        makeDraggable(document.querySelector('#tastingModal .modal'));
    </script>
</body>
</html>
